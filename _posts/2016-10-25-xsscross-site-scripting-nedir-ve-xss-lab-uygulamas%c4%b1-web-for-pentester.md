---
layout: post
title: XSS(Cross Site Scripting) Nedir?  ve XSS Lab Uygulaması (Web for Pentester)
date: 2016-10-25 17:13
author: ahmetgurel
comments: true
categories: [dom xss, Siber Güvenlik, Sızma Testi Araçları (Pentest Tools), web for pentester, Web for Pentester XSS Çözümleri, web pentest, web security, Web Uygulama Güvenliği, xss, XSS Stored]
---
<blockquote><b>Cross site scripting</b> (<b>XSS</b>), bilgisayar güvenlik açığı. HTML kodlarının arasına istemci tabanlı kod gömülmesi yoluyla kullanıcının tarayıcısında istenen istemci tabanlı kodun çalıştırılabilmesi olarak tanımlanır.</blockquote>
<h1 id="firstHeading" class="firstHeading" lang="en"></h1>
&nbsp;

Cross-Site Scripting (XSS) OWASP Top 10 listesinde bulunmaktadır.Bu yazımda Web for Pentester uygulamasının XSS Bölümlerini çözeceğim. <a href="https://pentesterlab.com/exercises/web_for_pentester/">https://pentesterlab.com/exercises/web_for_pentester/</a> Linkinden ISO dosyasını indirerek sanal makinenizde açarak sanal makinanın IP adresi ile tarayıcınızdan uygulamaya erişebilirsiniz.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-0.png"><img class="size-large wp-image-589 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-0-1024x538.png" alt="1-0" width="976" height="513" /></a>

Web for Pentesterın ana sayfası görüldüğü gibidir.Bir çok web zaafiyetini öğretmek için hazırlanmıştır.Sonraki yazılarımda diğer zaafiyetlerede değinmeye çalışacağım.Bu yazı için XSS de bulunan 9 örneği çözeceğiz.

<strong>XSS Türleri:</strong>

Başlamadan önce XSS Türleri hakkında kısaca bilgi vereyim.3 Çeşit XSS Türü vardır.1- Reflected XSS 2- Stored/Persistent XSS 3- Dom XSS
<ol>
	<li><strong>Reflected XSS: </strong>Kullanıcının girilmesi beklenen parametre yerine Javascript  kodu girerek bunu ekrana yansıtması ile tespit edilebilen XSS çeşitidir.</li>
	<li><strong>Stored/Persistent XSS: </strong>Adında anlaşılacağı üzere kalıcı XSS türüdür.Bu sefer girilen payloadlar anlık olarak yansımaz bir veritabanına yada başka bir yere kayıt edilir daha sonradan ziyaret edildiğinde çalışan XSS çeşitidir.</li>
	<li><strong>Dom XSS: </strong>Dom (Document Object Model) XSS Dom lardan kaynaklanan XSS dir.Gemelde # işaretinden sonra payload denenmesi ve sayfa yenilendiğinde alert alındığında DOM XSS var denilen XSS açıklığıdır.İşin teorik bilgisi DOM nesnesinden kaynaklandığı için en tehlikeli XSS türü olarak anılmaktadır.Derinlemesine öğrenmek için <a href="https://twitter.com/Om3rCitak">Ömer</a>'in <a href="http://omercitak.com/dom-based-xssi-anlamak/">http://omercitak.com/dom-based-xssi-anlamak/</a> yazısına mutlaka göz atın derim güzel bir yazı olmuş.</li>
</ol>
<strong>XSS ile Neler Yapılabilir?</strong>

XSS ile javascript kodları çalıştırabilmekteyiz.Burada zararlı kodlar kullanıldığında  Cookie çalma,sayfanın içinde başka sayfaya yönlendirme.Sitemize zararlı kodlar gömerek istedikleri başka saldırılar gerçekleştirebilirler.Web dünyasında önemli ve kritik açıklıklar arasında yer almaktadır.BeEF (The Browser Exploitation Framework Project) ile XSS açıklıklarını sömürebilirsiniz.

Gelelim şimdi uygulama kısmına XSS Tespit edilmesi ve sayfada alert görmek hedefimiz.Bunun için Web for Pentesterın XSS bölümlerine başlıyoruz.

&nbsp;

<strong>Example 1:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-1.png"><img class="size-large wp-image-592 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-1-1024x522.png" alt="1-1" width="976" height="498" /></a>

&nbsp;

Kullanıcıdan beklenen name parametesi için bir deneme yaptık.Bizim payload yazarken kullanacağımız herhangi bir şey filtrelenmiş mi diye baktık ve hiç biri bu örnek için filtrelenmemiş.Buraya bir payload yazarak  XSS tespiti var mı yok mu karar verebiliriz.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-2.png"><img class="size-large wp-image-593 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-2-1024x299.png" alt="1-2" width="976" height="285" /></a>

Burada <strong>&lt;script&gt;alert(1)&lt;/script&gt;</strong> payloadımızı girerek ekrana alerti bastırarak XSS imizi bulmuş bulunmaktayız.alertin içine isim yazı yazmak isterseniz <strong>&lt;script&gt;alert("XSS")&lt;/script&gt;</strong> tarzında yazabilirsiniz.Fakat bazen tırnak işaretlerinin filtrelenmesinden dolayı direk sayı girerek tırnak kullanmadan alert almak daha sağlıklı sonuçlar vermektedir.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-3.png"><img class="size-large wp-image-594 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/1-3-1024x531.png" alt="1-3" width="976" height="506" /></a>

&nbsp;

Sayfa kaynağını görüntüle diyerek yazdığımız payloadın kodlarda nasıl göründüğüne bakarak daha etkili sonuçlar alabiliriz.

<strong>Example 2:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-0.png"><img class="size-large wp-image-597 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-0-1024x244.png" alt="2-0" width="976" height="233" /></a>

Bir önceki örnekteki  payloadımızı  girdiğimizde alert alamadık ve yazdığımız payloadın script tagları giderek ekrena Hello alert(1) yazdı.Yazılımcı arka tarafta script kodlarını filtrelemiş.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-1.png"><img class="size-large wp-image-598 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-1-1024x520.png" alt="2-1" width="976" height="496" /></a>

Bunu sayfa kaynağındada görebilmekteyiz.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-2.png"><img class="size-large wp-image-599 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-2-1024x236.png" alt="2-2" width="976" height="225" /></a>

Payload:<strong> &lt;SCRIPT&gt;alert(1)&lt;/SCRIPT&gt;</strong>  olarak yazıp denediğimizde pop-up geldi.Yazılımcı sadece küçük script tagını filtrelemiş biz büyük girdiğimizde alertimizi alabildik.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-3.png"><img class="size-large wp-image-600 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-3-1024x177.png" alt="2-3" width="976" height="169" /></a>

Tagı büyük olarak yazıp bypass edebileceğimiz gibi  <strong>&lt;sc&lt;script&gt;ript&gt;alert(1)&lt;/sc&lt;/script&gt;ript&gt;</strong> gibi iç içe script payloadı yazarakta çalışmakta.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-4.png"><img class="size-large wp-image-601 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/2-4-1024x512.png" alt="2-4" width="976" height="488" /></a>

Sayfa kaynağında görüldüğü gibi bir script filtrelenirken iç içe yazdığımız için istediğimiz kod haline gelmektedir.script taglar filtrelendiğinde bu şekilde aşabileceğiniz gibi içinde script tagı bulunmayan payloadlarda deneyebilirsiniz.

<strong>Example 3:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/3-1.png"><img class="size-large wp-image-602 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/3-1-1024x169.png" alt="3-1" width="976" height="161" /></a>

Bu örnekte büyük SCRIPT tagınıda engellemiş yazılımcı fakat yine iç içe script tagı yazarak aşabilmekteyiz.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/3-2.png"><img class="size-large wp-image-603 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/3-2-1024x206.png" alt="3-2" width="976" height="196" /></a>

Bu örnekte script tagları engellendiği için içinde script tagı bulunmayan <strong>&lt;svg onload=alert(1)&gt;</strong> gibi bir payload girerek yine alert aldırabiliriz.

&nbsp;

<strong>Example 4:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/4-1.png"><img class="size-large wp-image-604 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/4-1-1024x168.png" alt="4-1" width="976" height="160" /></a>

Bu örnektede  <strong>&lt;svg onload=alert(1)&gt;</strong> payloadı ile alert alınabilmekte.

<strong>Example 5:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/5-1.png"><img class="size-large wp-image-605 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/5-1-1024x187.png" alt="5-1" width="976" height="178" /></a>

Bu örnekte <strong>&lt;svg onload=alert(1)&gt;</strong> payloadını girdiğimizde error vermekte.Yazılımcı alert fonksiyonunda hata verdirmiş arkadaşlar.Bunun için bizde alert ile aynı işi gören <strong>prompt</strong> kullanarak aşacağız.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/5-2.png"><img class="size-large wp-image-606 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/5-2-1024x166.png" alt="5-2" width="976" height="158" /></a>

Bu örneğide <strong> &lt;svg onload=prompt(1)&gt;</strong> payloadı  ile çözülebilmekte.

&nbsp;

<strong>Example 6:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-1.png"><img class="size-large wp-image-607 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-1-1024x210.png" alt="6-1" width="976" height="200" /></a>

<strong>&lt;svg onload=alert(1)&gt;</strong> payloadımızı girdiğimizde bir hata yada ekrana bir pop-up oluşmadı.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-2.png"><img class="size-large wp-image-608 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-2-1024x535.png" alt="6-2" width="976" height="510" /></a>

Sayfa kaynağını görüntülediğimizde ise girdiğimiz değişkeni bir değişkene atandığını görmekteyiz.Bu yüzden kodlarımız çalışmıyor.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-3.png"><img class="size-large wp-image-609 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-3-1024x174.png" alt="6-3" width="976" height="166" /></a>

Fakat payload olarak<strong> "; alert(1);"</strong> girdiğimizde önce değişkeni kapatıp sonra diğer " nığı kapatarak syntax hatası almadan alertimizi bastırdık.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-4.png"><img class="size-large wp-image-610 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/6-4-1024x536.png" alt="6-4" width="976" height="511" /></a>

49.satıra dikkatli bakarsak payloadımızı ve yazılımcının filtresini nasıl bypass ettiğimizi görebilirsiniz.

&nbsp;

<strong>Example 7:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/7-1.png"><img class="size-large wp-image-611 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/7-1-1024x545.png" alt="7-1" width="976" height="519" /></a>

Bu örnekte sayfa kaynağını görüntülediğimizde bir önceki gibi olduğunun sadece çift tırnak yerine tek tırnak kullanıldığı görülmektedir.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/7-2.png"><img class="size-large wp-image-612 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/7-2-1024x237.png" alt="7-2" width="976" height="226" /></a>

&nbsp;

Payload olarak <strong> '; alert(1);' </strong>girdiğimizde yine hedefimize ulaşmış olmaktayız.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/7-3.png"><img class="size-large wp-image-613 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/7-3-1024x545.png" alt="7-3" width="976" height="519" /></a>

Sayfa kaynağında 50.satırda bunu görebilmekteyiz.

&nbsp;

<strong>Example 8:</strong>

Bu örnekte durum farklı artık bir parametreye değilde html form a payload girmemiz gerekiyor.Sayfanın kaynağını görüntüleyip inceliyoruz.<strong>/xss/example8.php </strong>bağlantısı sayfa içinde yineleniyor.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/8-0.png"><img class="size-large wp-image-614 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/8-0-1024x239.png" alt="8-0" width="976" height="228" /></a>

Payload olarak<strong> /" onmouseover="alert(1); </strong>girildiğinde mouse ile üstüne geldiğimizde pop-upımız açılacaktır.

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/8-11.png"><img class="size-large wp-image-617 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/8-11-1024x540.png" alt="8-1" width="976" height="515" /></a>

&nbsp;

<strong>Example 9:</strong>

<a href="http://www.gurelahmet.com/wp-content/uploads/2016/10/9-1.png"><img class="size-large wp-image-618 aligncenter" src="http://www.gurelahmet.com/wp-content/uploads/2016/10/9-1-1024x183.png" alt="9-1" width="976" height="174" /></a>

&nbsp;

# işaretinden sonra &lt;script&gt;alert(1)&lt;/script&gt;  payloadı girerek sayfayı yenilediğimizde alert ekrana yansıyacaktır.Bu yazının başında değindiğim Dom XSS türüdür.

&nbsp;

Genel olarak XSS i tanıyarak bir kaç bypass yolunu örneklerle inceledik.İnşallah faydalı olmuştur.Bir çok XSS payloadı bulunmakta ve türemekte duruma koda göre BugBounty (Bugcrowd,HackerOne vb.)  ile uğraşan arkadaşlar kendilerini geliştirip çok farklı payloadlar bulmaktadır.Bir çok XSS Payloadına <a href="https://packetstormsecurity.com/files/112152/Cross-Site-Scripting-Payloads.html">https://packetstormsecurity.com/files/112152/Cross-Site-Scripting-Payloads.html</a> adresinden ulaşabilirsiniz.

<strong>XSS i Nasıl Engelleyebiliriz?</strong>

Birde buradaki örnekte gördüğünüz gibi <strong>Blacklist</strong> yöntemi ile XSS den korunmaya çalışılmış.Siz neyi filtrelerseniz filtreleyin saldırgan bir şekilde bypass edebilmekte.Bunun için <strong>Whitelist </strong> metodu kullanılarak ne gerekli ise o alınmalı onun dışındaki her şey engellenmelidir.

Başka bir yazıda görüşmek üzere :)
